---
description: Enables Multiplayer experiences
---

# üåê Multiplayer in Terra Studio

**Terra Studio** supports full multiplayer capabilities using **Netcode for Unity** ‚Äî Unity‚Äôs official networking solution for GameObjects ( **(see the full documentation  at** [**Unity Multiplayer Netcode Docs)**](https://docs-multiplayer.unity3d.com/netcode/1.10.0/about/). All standard Netcode workflows and components are supported directly, so if you‚Äôve used Netcode before, you‚Äôre ready to go.

{% hint style="success" %}
Terra Studio uses ‚û°Ô∏è [Netcode for GameObjects ‚Äì Unity Docs (v1.10.0)](https://docs-multiplayer.unity3d.com/netcode/1.10.0/about/)
{% endhint %}

***

## üöÄ Getting Started with Multiplayer

Just like with Unity, multiplayer scripts in Terra Studio derive from `NetworkBehaviour`. However, in Terra Studio, multiplayer scripts should **inherit from `TerraNetBehaviour`**, which wraps Unity's networking base class and is fully compatible with Netcode workflows.

### ‚úÖ Basic Script Structure

```csharp
public class MyMultiplayerScript : TerraNetBehaviour
{
    // Code specific to this networked object

    // Called when the object is spawned on the network
    public override void OnNetworkSpawn()
    {
        // Initialization logic
    }

    // Called when the object is despawned from the network
    public override void OnNetworkDespawn()
    {
        // Cleanup logic
    }
}
```

These two lifecycle methods are useful for initializing and cleaning up your networked GameObjects.

***

## üõ† Things to Keep in Mind

* Every GameObject you want to network must have a `NetworkObject` component.
* Any networked script must extend `TerraNetBehaviour` (not `MonoBehaviour` or `TerraBehaviour`).
* Refer to the Unity Netcode documentation for working with RPCs, ownership, spawning, synchronization, and more.

***

{% hint style="info" %}
Unity‚Äôs official Netcode documentation covers all essential multiplayer features you may need: ‚û°Ô∏è [Netcode for GameObjects ‚Äì Unity Docs (v1.10.0)](https://docs-multiplayer.unity3d.com/netcode/1.10.0/about/)
{% endhint %}

## Multiplayer Events

TerraNet provides a number of events that are triggered when key network and scene activities occur. These events allow you to adjust your user interface, initialize game logic, or clean up resources at the right time. The events are grouped into two main categories: Matchmaking/Lobby events and Scene Management events.

### Matchmaking & Lobby Events

* `TerraNet.OnMatchMakingStopped`\
  &#xNAN;_&#x54;riggered when matchmaking has started, but the player presses the back button to cancel it._
* `TerraNet.OnMatchFound`
  * **2 Players:** Triggered when the second player joins using the match code. (Use this event to hide matchmaking UI and transition to the loading screen.)
  * **More Than 2 Players:** Triggered when the host clicks the "Start Game" button once the minimum required number of players has been reached.
* `TerraNet.OnAllUsersConnected`\
  &#xNAN;_&#x46;ires when all players have successfully connected. Use this event to hide the loading screen and begin game play._

If a disconnection occurs before the match is fully ready (i.e., before all players are connected), then monitor these events:

* `TerraNet.OnHostDisconnected`
* `TerraNet.OnRoomLeft`
* `TerraNet.OnPlayerRoomLeft`
* `TerraNet.OnMatchMakingUiClose`\
  &#xNAN;_&#x54;riggered when the matchmaking UI is closed._

***

### &#x20;Scene Management & Synchronization Events

These events help coordinate scene loading, unloading, and synchronization across the network. **Important:** Do not start new scene events within these notification callbacks.

* `TerraNet.OnNetSceneLoad`\
  &#xNAN;_&#x49;nvoked when a SceneEventType.Load event is started by the server. All connected clients receive this notification._
* `TerraNet.OnNetSceneLoadComplete`\
  &#xNAN;_&#x54;riggered when a client or the server generates a SceneEventType.LoadComplete event. The server will receive this notification from every client._
* `TerraNet.OnNetSceneLoadEventComplete`\
  &#xNAN;_&#x46;ired when the server generates a SceneEventType.LoadEventCompleted event. This signals that all clients (and the server) have finished the load event‚Äîhelpful for confirming synchronization when loading a scene (either in single or additive mode)._
* `TerraNet.OnNetSceneUnLoad`\
  &#xNAN;_&#x54;riggered when a SceneEventType.Unload event is started by the server. All connected clients receive this notification._
* `TerraNet.OnNetSceneUnLoadComplete`\
  &#xNAN;_&#x43;alled when a SceneEventType.UnloadComplete event is generated by any client or the server. Each client‚Äôs notification is sent to the server._
* `TerraNet.OnNetSceneUnLoadEventComplete`\
  &#xNAN;_&#x49;nvoked when the server generates a SceneEventType.UnloadEventCompleted event. This signifies that all clients (and the server) have completed unloading a scene. The LoadSceneMode for this event is always Additive._
* `TerraNet.OnNetSceneSynchronize`\
  &#xNAN;_&#x43;alled when a SceneEventType.Synchronize event is started by the server after a new client is approved, allowing that client to sync its scenes and NetworkObjects._
* `TerraNet.OnNetSceneSynchronizeComplete`\
  &#xNAN;_&#x54;riggered when a client completes the SceneEventType.Synchronize event. The server receives a notification from each client (but does not generate this event for itself), which lets you know that the client is fully synchronized._

***

## TerraNet Functions

These functions provide control over matchmaking, room sessions, scene management, and synchronized properties. They enable you to start and stop matchmaking, control networked scenes, and access session settings.

### Matchmaking API

*   `TerraNet.StartMatchMaking(gameName)`\
    &#xNAN;_&#x53;tarts the matchmaking process, for example when the player clicks "Play with Friends."_

    **Relay Variants:**

    * `TerraNet.StartMatchMaking(gameName, gameMode);`
    * `TerraNet.StartMatchMaking(gameName, gameMode, roomId);`
    * `TerraNet.StartMatchMaking(gameName, gameMode, autoRoomCreate);`
* `TerraNet.StartMatchMakingDedicated(...)`\
  &#xNAN;_&#x55;sed for dedicated server scenarios; similar overloads are available._
* `TerraNet.StopMatchMaking()`\
  &#xNAN;_&#x53;tops the matchmaking process._
* `TerraNet.DisableMatchMakingUI()`\
  &#xNAN;_&#x44;isables the matchmaking user interface._
* `TerraNet.EnableMatchMakingUI()`\
  &#xNAN;_&#x45;nables the matchmaking user interface._

### Session & Room Control

* `TerraNet.ShutdownSession()`\
  &#xNAN;_&#x43;all this when the game is exited and the player returns to the home screen._
* `TerraNet.ServerReady()`\
  &#xNAN;_&#x55;sed on dedicated servers. Trigger this when your server is ready to receive new players._
* `TerraNet.GetMaxPlayers()`\
  &#xNAN;_&#x52;eturns the maximum number of players allowed, as defined in the database._
* `TerraNet.GetMinPlayers()`\
  &#xNAN;_&#x52;eturns the minimum number of players required to start a match._
* `TerraNet.GetExpectedPlayers()`\
  &#xNAN;_&#x52;eturns a list of players who have joined using the match code (only players who entered the code are included)._

### Scene Management

* `TerraNet.LoadNetworkedScene(sceneName)`\
  &#xNAN;_&#x4C;oads the specified networked scene._
* `TerraNet.UnloadNetworkedScene(sceneName)`\
  &#xNAN;_&#x55;nloads the specified networked scene._
* `TerraNet.IsSceneNetworkReady(sceneName)`\
  &#xNAN;_&#x43;hecks if a scene is ready for network synchronization._

### Synchronized Properties

* `TerraNet.UpdateSyncProperty(key, value)`\
  &#xNAN;_&#x55;pdates a synchronized property across clients._
* `TerraNet.GetSyncProperty(key)`\
  &#xNAN;_&#x52;etrieves the value of a synchronized property using the specified key._

***

## TerraNetBehaviour API

Extend `TerraNetBehaviour` in your networked scripts to access properties, override callbacks, and send custom RPCs.

### Key Properties

* **NetworkManager**\
  &#xNAN;_&#x52;etrieves the network manager instance._
* **NetworkObject**\
  &#xNAN;_&#x52;etrieves the network object instance._
* **IsPlayerObject**\
  &#xNAN;_&#x52;eturns true if this object is associated with a player._
* **IsServer, IsHost, IsClient**\
  &#xNAN;_&#x42;oolean flags indicating the network role of the application._
* **NetworkObjectId**\
  &#xNAN;_&#x54;he unique ID of this networked object._
* **LocalClientId**\
  &#xNAN;_&#x52;eturns the server's client ID if `IsServer` is true; otherwise, it returns the local client ID._
* **ServerClientId**\
  &#xNAN;_&#x41; constant ID (always 0) representing the server._
* **ConnectedClients**\
  &#xNAN;_&#x50;rovides a list of client IDs for all connected clients (server-only property)._

### Overridable Callbacks

Override these methods in your `TerraNetBehaviour` script to respond to network events:

* **OnNetworkSpawn()**\
  &#xNAN;_&#x43;alled when the NetworkObject is spawned. Use this to register RPC handlers or initialize network state._
* **OnNetworkDespawn()**\
  &#xNAN;_&#x43;alled when the NetworkObject is despawned. Use this to clean up any network-specific resources._
* **OnClientConnect(ulong clientId)**\
  &#xNAN;_&#x43;alled on the server and on the connecting client when a new client connects._
* **OnClientDisconnect(ulong clientId)**\
  &#xNAN;_&#x43;alled on the server and on the disconnecting client when a client leaves._
* **OnRPCReceived(string key, object\[] args)**\
  &#xNAN;_&#x49;nvoked on the target machine when an RPC is received._
* **OnSyncPropertiesUpdated(string key, object value)**\
  &#xNAN;_&#x43;alled on all machines when a synchronized property is updated._

### Sending RPCs

Use the `SendRPC` function to send remote procedure calls to other clients or the server:

```csharp
SendRPC(SendTarget sendTo, string key, List<ulong> clientIds, object[] args);
```

**Note:**

* Use `SendTarget.SpecifiedInParams` when targeting specific client IDs.
* The `clientIds` list will be ignored if you are not targeting specific clients.

***

### Best Practices for Multiplayer Development in Terra Studio

* **Wait for Full Connection:** Use `TerraNet.OnAllUsersConnected` to ensure that all players have connected before starting gameplay.
* **Don‚Äôt Start New Scene Events Inside Callbacks:** Always complete scene events before triggering new ones.
* **Keep Synchronized Properties Up-To-Date:** Use `UpdateSyncProperty()` to share gameplay-critical information (e.g., match timers).
* **Use SendRPC for Gameplay Instructions:** Leverage RPC calls for actions like updating positions, syncing health, or triggering animations.
* **Test Thoroughly:** Network timing can be variable; make sure to test multiplayer scenarios (especially on different network conditions).

###
